<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Mosaddek">
    <meta name="keyword" content="FlatLab, Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <link rel="shortcut icon" href="views/img/favicon.png">

    <title>Контакты</title>

    <!-- Bootstrap core CSS -->
    <link href="views/css/bootstrap.min.css" rel="stylesheet">
    <link href="views/css/bootstrap-reset.css" rel="stylesheet">
    <!--external css-->
    <link href="views/assets/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <link href="views/css/tasks.css" rel="stylesheet">
    <!--dynamic table-->
    <link href="views/assets/advanced-datatable/media/css/demo_page.css" rel="stylesheet" />
    <link href="views/assets/advanced-datatable/media/css/demo_table.css" rel="stylesheet" />
    <link rel="stylesheet" href="views/assets/data-tables/DT_bootstrap.css" />
      <!--right slidebar-->
      <link href="views/css/slidebars.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="views/css/style.css" rel="stylesheet">
    <link href="views/css/style-responsive.css" rel="stylesheet" />
	
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 tooltipss and media queries -->
    <!--[if lt IE 9]>
      <script src="js/html5shiv.js"></script>
      <script src="js/respond.min.js"></script>
    <![endif]-->
  </head>

  <body>
      
  <section id="container" class="">
      <!--header start-->
      <?php include $user ?>
      <!--header end-->
      <!--sidebar start-->
      <?php include $aside ?>
      <!--sidebar end-->
  
      <!--main content start-->
      <section id="main-content">
          <section class="wrapper">
              <!-- page start-->
              <div class="row">
                <div class="col-sm-12">
              <section class="panel">
              <header class="panel-heading">
                  Контакты
              <span class="tools pull-right">
                <a data-toggle="modal" href="#myModal17" title="Дополнительные поля" data-placement="bottom" data-toggle="tooltip" class="fa fa-cogs"></a>
				
				<!-- Modal Дополнительные настройки -->
                              <div class="modal fade full-width-modal-right" id="myModal17" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                  <div class="modal-dialog modal-sm">
                                      <div class="modal-content-wrap">
                                          <form action="?action=cont_table" method="post">
                                          <div class="modal-content">
                                              <div class="modal-header">
                                                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                  <h4 class="modal-title">Дополнительные поля</h4>
                                              </div>
                                              <div class="modal-body">
												  <br/>
                                                  Выберите колонки, которые хотите видеть в основной таблице "Контакты"
												  <br/><br/><br/>
												  <div class="checkbox-list">
													  <label for="closeButton">
														<div class="checker" id="uniform-closeButton">
                                                        
															<span class="checked"><input name="name" id="closeButton" type="checkbox" value="checked"   class="input-small" <?php if(isset($_SESSION['cont_name'])){ echo 'checked'; }?> ></span>
                            
														</div>
														  Наименование
													  </label>
													  <label for="closeButton">
														<div class="checker" id="uniform-closeButton">
															<span class="checked"><input name="contragent" id="closeButton" type="checkbox" value="checked"  class="input-small" <?php if(isset($_SESSION['cont_contragent'])){ echo 'checked'; }?> ></span>
														</div>
														  Контрагент
													  </label>
													  <label for="closeButton">
														<div class="checker" id="uniform-closeButton">
															<span class="checked"><input name="phone" id="closeButton" type="checkbox" value="checked"  class="input-small" <?php if(isset($_SESSION['cont_phone'])){ echo 'checked'; }?> ></span>
														</div>
														  Телефон
													  </label>
													  <label for="closeButton">
														<div class="checker" id="uniform-closeButton">
															<span class="checked"><input name="email" id="closeButton" type="checkbox" value="checked"  class="input-small" <?php if(isset($_SESSION['cont_email'])){ echo 'checked'; }?> ></span>
														</div>
														  E-mail
													  </label>
													  <label for="closeButton">
														<div class="checker" id="uniform-closeButton">
															<span class="checked"><input name="status" id="closeButton" type="checkbox" value="checked"  class="input-small" <?php if(isset($_SESSION['cont_status'])){ echo 'checked'; }?> ></span>
														</div>
														  Статус
													  </label>
													  <label for="addBehaviorOnToastClick">
														<div class="checker" id="uniform-addBehaviorOnToastClick">
															<span><input name="post" id="addBehaviorOnToastClick" type="checkbox" value="checked" class="input-small" <?php if(isset($_SESSION['cont_post'])){ echo 'checked'; }?> ></span>
														</div>
														  Должность
													  </label>
													  <label for="debugInfo">
														<div class="checker" id="uniform-debugInfo">
															<span><input name="skype"  id="debugInfo" type="checkbox" value="checked" class="input-small" <?php if(isset($_SESSION['cont_skype'])){ echo 'checked'; }?> ></span>
														</div>
														  Skype
													  </label>
													 
													  <label  for="progressBar">
														  <div class="checker" id="progress-info">
															  <span><input name="author" id="progressBar" type="checkbox" value="checked" class="input-mini" <?php if(isset($_SESSION['cont_author'])){ echo 'checked'; }?> /></span>
														  </div>
														  Автор
													  </label>
                                                      
													  <label  for="progressBar">
														  <div class="checker" id="progress-info">
															  <span><input name="task" id="progressBar" type="checkbox" value="checked" class="input-mini" <?php if(isset($_SESSION['cont_task'])){ echo 'checked'; }?>  /></span>
														  </div>
														  Ближайшая задача
													  </label>
												  </div>
                                                  
                                              </div>
											  <br/><br/><br/>
                                              <div class="modal-footer">
                                                  <button class="btn btn-warning" type="submit">Сохранить</button>
                                              </div>
                                          </div>
                                          </form>

                                      </div>
                                  </div>
                              </div>
                <!-- modal Дополнительные настройки-->
				
                <a href="javascript:;" title="Распечатать таблицу" data-placement="bottom" data-toggle="tooltip " class="fa fa-print" onclick="window.print()"></a>
				<a href="javascript:;" title="Скачать в xls" data-placement="bottom" data-toggle="tooltip " class="fa fa-download"></a>
				<button data-toggle="modal" href="#myModal4" class="btn btn-success btn-sm">Добавить контакт</button>
				
				<!--Modal Добавить контакт-->
                            <form action="?action=cont_add_contact" method="post">
                              <div class="modal fade modal-dialog-center " id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                                  <div class="modal-dialog ">
                                      <div class="modal-content-wrap">
                                          <div class="modal-content">
                                              <div class="modal-header">
                                                  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                                  <h4 class="modal-title">Новый контакт</h4>
                                              </div>
                                              <div class="modal-body">
													<br/>
													<input name="cont_lastname" type="text"  class="form-control" placeholder="Фамилия">
													<br/>
													<input name="cont_name" type="text"  class="form-control" placeholder="Имя">
													<br/>
													 
                                                    <select name="cont_post" class="form-control">
                                                    <?php // вывод должности 
                                                       $database = new database;
                                                       $array_posts = $database->db_get_post();

                                                       foreach($array_posts as $post)
                                                       {
													       print'<option value="'.$post['post_id'].'">'.$post['post_name'].'</option>';
                                                       }
                                                    ?>
									                </select>
													<br/>
                                                    <select name="cont_contragent"  class="form-control">
                                                    <option checked="" value="">Выбрать контрагента</option> 
                                                    <?php // вывод контрагентов 
                                                        $database = new database;
                                                        $array_contragents = $database->db_get_contragent();

                                                        foreach($array_contragents as $contragent)
                                                        {
                                                             print'<option value="'.$contragent['contr_id'].'">'.$contragent['contr_name'].'</option>';    
                                                        }
                                                    ?>
                                                    </select>
													<br/>
													<input name="cont_email" type="text"  class="form-control" placeholder="E-mail">
													<br/>
													<input name="cont_skype" type="text"  class="form-control" placeholder="Skype">
													<br/>
													<input name="cont_phone" type="text"  class="form-control" placeholder="Телефон">
													<br/>
                                              </div>
                                              <div class="modal-footer">
                                                  <button class="btn btn-warning" type="submit">Сохранить</button>
                                              </div>
                                          </div>
                                      </div>
                                  </div>
                              </div>
                            </form>
                <!-- Modal Добавить контакт -->
				
              </span>
              </header>
              <div class="panel-body">
              <div class="adv-table">
              <!-- <table class="display table table-bordered" id="hidden-table-info">-->
			  <table  class="display table table-bordered table-striped" id="dynamic-table"> 
              <thead>
              <tr>
                   <?php
                            
                                empty($_SESSION['cont_name'])      ? '': print'<th>Наименование</th>';
                                empty($_SESSION['cont_contragent'])? '': print'<th>Контрагент</th>';
                                empty($_SESSION['cont_phone'])     ? '': print'<th>Телефон</th>';
                                empty($_SESSION['cont_email'])     ? '': print'<th>E-mail</th>';
                                empty($_SESSION['cont_status'])    ? '': print'<th>Статус</th>';
                                empty($_SESSION['cont_post'])      ? '': print'<th>Должность</th>';
                                empty($_SESSION['cont_skype'])     ? '': print'<th>Skype</th>';
                                empty($_SESSION['cont_author'])    ? '': print'<th>Автор</th>';
                                empty($_SESSION['cont_task'])      ? '': print'<th>Ближайшая задача</th>'; 
                  ?>    
              </tr>
              </thead>
              <tbody>
                  <?php //вытаскиваю все данные по контактам из БД

                    $database = new database;
                    $array_contacts = $database->db_get_contact();

                    foreach($array_contacts as $contact) 
                    {
                        $contragent = $database ->db_get_contragentname($contact['cont_contragent']); //получить имя контрагента по id
                        $author     = $database ->db_get_username($contact['cont_author']); //получить имя и фамилию автора по id
                        $post       = $database ->db_get_postname($contact['cont_post']);// получить должность по id 
                        $task       = $database ->db_get_task_nearest_contact_id($contact['cont_id']); //задачу по id
                    
                        if(preg_match('~\s*Не выполнено\s*~u', $task))
                        {
                             $task = '<a style="color:#de5c5c">'.$task.'</a>';
                        }
                        elseif(preg_match('~\s*Просрочено\s*~u', $task))
                        {
                            $task = '<a style="color:#de5c5c">'.$task.'</a>';
                        }
                            
                            print'<tr class="gradeX">';
                                    empty($_SESSION['cont_name'])   ? '': print'
                                    <td>
                                        <a  href="?location=contact_one&id='.$contact['cont_id'].'" >'.$contact['cont_fullname'].'</a>
                                    </th>';
                                    empty($_SESSION['cont_contragent'])? '': print'<td>'.$contragent .'</th>';
                                    empty($_SESSION['cont_phone'])     ? '': print'<td>'.$contact['cont_phone'] .'</th>';
                                    empty($_SESSION['cont_email'])     ? '': print'<td>'.$contact['cont_email'] .'</th>';
                                    empty($_SESSION['cont_status'])    ? '': print'<td>'.$contact['cont_status'].'</th>';
                                    empty($_SESSION['cont_post'])      ? '': print'<td>'.$post.'</th>';
                                    empty($_SESSION['cont_skype'])     ? '': print'<td>'.$contact['cont_skype'].'</th>';
                                    empty($_SESSION['cont_author'])    ? '': print'<td>'.$author.'</th>';
                                    empty($_SESSION['cont_task'])      ? '': print'<td>'.$task.'</th>'; 
                            print'</tr>';
                        
                    }
                  ?>
              </tbody>
              </table>
              </div>
              </div>
              </section>
              </div>
              </div>
              <!-- page end-->
          </section>
      </section>
      <!--main content end-->
	  <br/><br/><br/><br/><br/><br/><br/><br/>
      <!--footer start-->
      <footer class="site-footer">
          <div class="text-center">
              2015 &copy; CRM by Mandryka.
              <a href="#" class="go-top">
                  <i class="fa fa-angle-up"></i>
              </a>
          </div>
      </footer>
      <!--footer end-->
  </section>

    <!-- js placed at the end of the document so the pages load faster -->

    <script src="views/js/jquery.js"></script>
    <script src="views/js/jquery-ui-1.9.2.custom.min.js"></script>
    <script src="views/js/jquery-migrate-1.2.1.min.js"></script>
    <script src="views/js/bootstrap.min.js"></script>
    <script class="include" type="text/javascript" src="views/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="views/js/jquery.scrollTo.min.js"></script>
    <script src="views/js/jquery.nicescroll.js" type="text/javascript"></script>
    <script type="text/javascript" language="javascript" src="views/assets/advanced-datatable/media/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="views/assets/data-tables/DT_bootstrap.js"></script>
    <script src="views/js/respond.min.js" ></script>

    <!--right slidebar-->
    <script src="views/js/slidebars.min.js"></script>

    <!--dynamic table initialization -->
    <script src="views/js/dynamic_table_init.js"></script>


    <!--common script for all pages-->
    <script src="views/js/common-scripts.js"></script>

  </body>
</html>
